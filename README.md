# AI D&D Platform üé≤ü§ñ

An open-source platform for playing Dungeons and Dragons online with AI assistance. Experience D&D like never before with AI-powered Dungeon Masters, NPCs, and even AI players, complete with voice synthesis and dynamic image generation.

## üåü Features

### üé≠ AI-Powered Gameplay

- **AI Dungeon Master**: Intelligent DM that creates dynamic stories and manages gameplay
- **AI NPCs**: Fully voiced non-player characters with unique personalities
- **AI Players**: Optional AI companions for solo adventures or to fill party roles

### üéÆ Flexible Play Modes

- **Solo Mode**: Play alone with AI companions and DM
- **Multiplayer Mode**: Play with friends, optionally with AI assistance
- **Hybrid Mode**: Mix human and AI players seamlessly

### üé® Rich Media Integration

- **Voice Synthesis**: Powered by [Resemble.ai](https://resemble.ai) for character voices
- **Dynamic Images**: Generated by [Flux.dev](https://flux.dev) for characters, scenes, and items
- **Interactive UI**: Modern, responsive interface for all platforms

### üåê Cross-Platform

- **Mobile**: iOS and Android native apps
- **Web**: Browser-based gameplay
- **Universal**: Seamless experience across all platforms

## üöÄ Quick Start

1. **Install dependencies**

   ```bash
   npm install
   ```

2. **Configure environment variables** (optional, for web platform)

   Create a `.env` file in the root directory:

   ```env
   # API routing (defaults to localhost dev)
   EXPO_PUBLIC_API_BASE_URL=http://localhost:8787

   # Ollama Configuration (for web platform)
   EXPO_PUBLIC_OLLAMA_BASE_URL=http://localhost:11434
   EXPO_PUBLIC_OLLAMA_MODEL=llama3.2
   # Optional API key for Ollama servers that require authentication
   EXPO_PUBLIC_OLLAMA_API_KEY=your-api-key-here

   # Kokoro TTS Configuration (optional)
   EXPO_PUBLIC_TTS_BASE_URL=http://localhost:5000

   # Google OAuth (for authentication)
   EXPO_PUBLIC_GOOGLE_CLIENT_ID=your-google-client-id
   EXPO_PUBLIC_GOOGLE_CLIENT_ID_WEB=your-google-client-id-web

   # Apple OAuth (for iOS authentication)
   EXPO_PUBLIC_APPLE_CLIENT_ID=your-apple-client-id
   ```

3. **Start the development server**

   ```bash
   npx expo start
   ```

4. **Choose your platform**
   - Press `i` for iOS simulator
   - Press `a` for Android emulator
   - Press `w` for web browser (runs at http://localhost:8081)
   - Scan QR code with Expo Go app

### Web Platform Setup

For web platform, you'll need:

1. **Ollama Server** (for AI inference):
   ```bash
   # Install Ollama from https://ollama.ai
   # Then pull a model:
   ollama pull llama3.2
   ```

2. **Kokoro TTS Server** (optional, for TTS):
   ```bash
   # Follow Kokoro TTS setup instructions
   # Default endpoint: http://localhost:5000
   ```

## üèóÔ∏è Development

### Prerequisites
- Node.js 22+ (LTS)
- Expo CLI
- For mobile development: iOS Simulator (macOS) or Android Studio

### Available Scripts

- `npm start` - Start Expo development server
- `npm run android` - Run on Android emulator
- `npm run ios` - Run on iOS simulator
- `npm run web` - Run in web browser
- `npm run lint` - Run ESLint
- `npm run test` - Run tests (when implemented)

### Project Structure

```
ai-dnd-expo/
‚îú‚îÄ‚îÄ app/              # File-based routing (Expo Router)
‚îú‚îÄ‚îÄ components/       # Reusable UI components
‚îú‚îÄ‚îÄ hooks/           # Custom React hooks
‚îú‚îÄ‚îÄ constants/       # App constants and configuration
‚îú‚îÄ‚îÄ assets/          # Static assets (images, fonts)
‚îú‚îÄ‚îÄ services/        # API services and integrations
‚îú‚îÄ‚îÄ types/           # TypeScript type definitions
‚îú‚îÄ‚îÄ utils/           # Utility functions
‚îî‚îÄ‚îÄ docs/            # Documentation
```

## ü§ñ AI Integration

### Core AI Services

- **Ollama** (Web): Local AI inference server for web platform
- **Cactus Compute** (Native): On-device AI inference for mobile platforms
- **Kokoro TTS**: Text-to-speech synthesis (web and native)
- **Expo Speech** (Native): Device TTS fallback for mobile platforms
- **Custom AI**: Game rule enforcement and story generation

### Platform-Specific AI Providers

- **Web**: Uses Ollama API for AI inference, Kokoro TTS for voice synthesis
- **Native (iOS/Android)**: Uses Cactus Compute or local ONNX models, Expo Speech or Kokoro TTS for voice
- **Fallback**: Rule-based responses when AI providers are unavailable

### AI Agent Types

- **Dungeon Master**: Manages story, NPCs, and game rules
- **Player Characters**: AI companions with unique personalities
- **NPCs**: Interactive non-player characters
- **Rule Advisor**: Helps with D&D rules and mechanics

## üéØ Roadmap

See [TODO.md](./TODO.md) for detailed development roadmap and feature planning.

## ü§ù Contributing

We welcome contributions! Please see our [AI-INSTRUCTIONS.md](./AI-INSTRUCTIONS.md) for guidelines on AI-assisted development.

### Development Guidelines

- Follow TypeScript best practices
- Use Expo Router for navigation
- Implement proper error handling
- Write tests for critical functionality
- Follow the existing code style

## üìö Documentation

- [AI Instructions](./AI-INSTRUCTIONS.md) - Guidelines for AI-assisted development
- [Development TODO](./TODO.md) - Feature roadmap and tasks
- [Claude Instructions](./CLAUDE.md) - Claude Code-specific guidance

## üîß Technology Stack

- **Frontend**: React Native + Expo
- **Language**: TypeScript
- **Navigation**: Expo Router
- **Styling**: React Native StyleSheet + Theming
- **State Management**: React Context (expanding to Redux Toolkit)
- **API Integration**: Axios + React Query
- **Voice**: Resemble.ai API
- **Images**: Flux.dev API
- **AI**: OpenAI/Anthropic APIs

## üì± Platform Support

- ‚úÖ iOS (iPhone & iPad)
- ‚úÖ Android
- ‚úÖ Web (Progressive Web App)
- üîÑ Desktop (future: Electron)

## üõ°Ô∏è Privacy & Security

- User data encryption
- Secure API key management
- Optional local-only mode
- GDPR compliance ready

## üìÑ License

MIT License - see [LICENSE](./LICENSE) for details.

## üé≤ Let's Play!

Ready to embark on your AI-assisted D&D adventure? Install the app and let the AI guide you through epic quests, memorable characters, and unforgettable stories.

## üöÄ Automated TestFlight Releases

Pushes to the `main` branch automatically trigger the **Release iOS to TestFlight** GitHub Action. The workflow installs dependencies, builds the iOS binary with the Expo Application Services (EAS) production profile, and submits the build to TestFlight.

### 1. Create the required credentials

1. **Expo access token** ‚Äì Generate a long-lived token from your Expo account settings (`https://expo.dev/accounts/<account>/settings/access-tokens>`).
2. **App Store Connect API key (recommended)** ‚Äì Create an API key with *App Manager* access in App Store Connect, then download the `.p8` file. Combine the key details into JSON and base64-encode it so it can be stored as a secret:
   ```bash
   cat <<'JSON' > asc-api-key.json
   {
     "keyId": "<KEY_ID>",
     "issuerId": "<ISSUER_ID>",
     "key": "$(tr -d '\n' < AuthKey_<KEY_ID>.p8)"
   }
   JSON

   base64 asc-api-key.json | pbcopy  # macOS example
   ```
   > You can alternatively provide an **App Store Connect app-specific password** if you cannot use an API key.
3. **Team and App identifiers** ‚Äì Note your Apple Developer Team ID (available in the Apple Developer portal) and the App Store Connect App ID (the numeric ID shown on the app‚Äôs App Information page).

### 2. Add GitHub Action secrets

Store the following secrets in **Settings ‚Üí Secrets and variables ‚Üí Actions**:

| Secret name | Required | Description |
| --- | --- | --- |
| `EXPO_TOKEN` | ‚úÖ | Expo access token used by the workflow to authenticate with EAS. |
| `EXPO_APP_STORE_CONNECT_API_KEY` | ‚úÖ (recommended) | Base64-encoded App Store Connect API key JSON as shown above. |
| `EXPO_APPLE_APP_SPECIFIC_PASSWORD` | ‚ö†Ô∏è (optional) | App-specific password for Apple ID. Only needed if you are not providing an API key. |
| `APPLE_TEAM_ID` | ‚úÖ | Apple Developer Team ID used for signing. |
| `APPLE_ASC_APP_ID` | ‚úÖ | Numeric App Store Connect App ID injected into `eas.json` before submission. |

The workflow fails fast if any required secret is missing. Provide either the API key **or** an app-specific password to allow Expo to authenticate with App Store Connect.

### 3. (Optional) Mirror credentials in Expo

If you also want to run the same release build from your local machine or directly from Expo, mirror the secrets into the Expo project:

```bash
eas secret:create --name EXPO_APP_STORE_CONNECT_API_KEY --scope project --type string --value "$(base64 asc-api-key.json)"
eas secret:create --name APPLE_TEAM_ID --scope project --type string --value "<TEAM_ID>"
eas secret:create --name APPLE_ASC_APP_ID --scope project --type string --value "<APP_ID>"
```

### 4. Triggering a release

Once the secrets are configured, every push to `main` will build and submit the iOS production profile to TestFlight automatically. Track build and submission progress in the GitHub Actions run log or in the [Expo EAS dashboard](https://expo.dev/accounts) for deeper visibility.
